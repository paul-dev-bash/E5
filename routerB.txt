enable
configure terminal

### config interface

interface FastEthernet 0/0
no shutdown

interface FastEthernet 0/0.20
enc dot 20
ip add 192.168.21.1 255.255.255.0
ip nat inside

interface FastEthernet 0/0.30
enc dot 30
ip add 192.168.31.1 255.255.255.0

interface FastEthernet 0/0.40
enc dot 40
ip add 192.168.41.1 255.255.255.0
exit

interface FastEthernet 0/1
no shutdown
ip address 20.0.0.253 255.0.0.0
ip nat outside
exit

### serveur DHCP
ip dhcp excluded-address 192.168.21.1
ip dhcp excluded-address 192.168.41.1

ip dhcp pool lan21
network 192.168.21.0 255.255.255.0
default-router 192.168.21.1
dns-server 192.168.10.10
exit

ip dhcp pool lan41
network 192.168.41.0 255.255.255.0
default-router 192.168.41.1
exit

### route
ip route 0.0.0.0 0.0.0.0 20.0.0.254

### firewall + NAT
access-list 100 deny ip 192.168.21.0 0.0.0.255 192.168.10.0 0.0.0.255
access-list 100 permit ip 192.168.21.0 0.0.0.255 any
ip nat inside source list 100 interface FastEthernet 0/1 overload


### VPN2VPN

crypto isakmp enable
crypto isakmp policy 10
encryption aes
authentication pre-share
hash sha
group 2
lifetime 86400
exit

crypto isakmp key CLESECRETE address 10.0.0.253

crypto ipsec transform-set VPNLABO esp-aes esp-sha-hmac
crypto ipsec security-association lifetime seconds 86400
ip access-list extended VPN
permit ip 192.168.21.0 0.0.0.255 192.168.10.0 0.0.0.255
exit

crypto map CARTEVPN 10 ipsec-isakmp
match address VPN
set peer 10.0.0.253
set transform-set VPNLABO
exit

interface FastEthernet 0/1
crypto map CARTEVPN


end
wr me

